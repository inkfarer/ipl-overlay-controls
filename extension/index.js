(()=>{"use strict";var e={59:(e,t,n)=>{var a,r=n(19),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=r?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)),l=(a=n(118))&&a.__esModule?a:{default:a},i=n(575);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}const u=o.get(),c=u.Router();c.post("/upload-tournament-json",(0,l.default)({limits:{fileSize:52428800}}),((e,t)=>{if(!e.files||!e.files.file||!e.body.jsonType||"application/json"!==e.files.file.mimetype)return t.sendStatus(400);const n=e.files.file,a=JSON.parse(n.data.toString());switch(e.body.jsonType){case"rounds":{const e=(0,r.handleRoundData)(a),t=u.Replicant("rounds");t.value={...t.value,...e};break}case"teams":{const e=(0,i.handleRawData)(a,`Uploaded file: ${n.name}`);u.Replicant("tournamentData").value=e;break}default:return t.sendStatus(400)}t.sendStatus(200)})),u.mount("/ipl-overlay-controls",c)},57:(e,t,n)=>{function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}const r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=o?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(r,l,i):r[l]=e[l]}return r.default=e,n&&n.set(e,r),r}(n(798)).get(),o=r.Replicant("gameWinners"),l=r.Replicant("teamScores"),i=r.Replicant("setWinnersAutomatically"),s=r.Replicant("activeRoundId");l.on("change",((e,t)=>{if(!i.value||!t)return;const n=e.teamA+e.teamB;1===n&&(1===e.teamA?o.value[0]=1:o.value[0]=2),n>=2&&0!==o.value[0]&&(e.teamA===t.teamA?o.value[n-1]=2:o.value[n-1]=1)})),s.on("change",((e,t)=>{t&&(o.value=[0,0,0,0,0,0,0])}))},715:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=o?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(a,l,i):a[l]=e[l]}return a.default=e,n&&n.set(e,a),a}(n(798));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}t.default=e=>{a.set(e),n(550),n(57),n(575),n(19),n(59);const t=e.Replicant("radiaSettings");e.bundleConfig&&void 0!==e.bundleConfig.radia?(t.value.enabled=!0,n(708)):(e.log.warn(`"radia" is not defined in cfg/${e.bundleName}.json! The ability to import data via the Radia\n            Production API won't be possible.`),t.value.enabled=!1)},e.exports=t.default},550:(e,t,n)=>{var a,r=n(172),o=(a=n(198))&&a.__esModule?a:{default:a};function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=r?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(a,o,i):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)).get();!function(){if(!i.bundleConfig||void 0===i.bundleConfig.lastfm)return void i.log.warn(`"lastfm" is not defined in cfg/${i.bundleName}.json! Getting music information automatically will not function.`);const e=new r.LastFmNode({api_key:i.bundleConfig.lastfm.apiKey,secret:i.bundleConfig.lastfm.secret}),t=i.Replicant("lastFmNowPlaying",{persistent:!1});let n;i.Replicant("lastFmSettings").on("change",(a=>{n&&n.stop(),n=e.stream(a.username),n.on("nowPlaying",(e=>{t.value={artist:e.artist["#text"],song:e.name,album:e.album["#text"],cover:e.image[2]["#text"],artistSong:`${e.artist["#text"]} - ${e.name}`}})),n.on("error",(e=>{6===e.error&&(i.log.info(`Last.fm couldn't find user "${a.username}" - error message: "${e.message}"`),n.stop())})),n.start()}))}(),function(){const e=i.Replicant("lastFmNowPlaying"),t=i.Replicant("manualNowPlaying"),n=i.Replicant("nowPlayingSource"),a=i.Replicant("nowPlaying"),r={lastfm:e,manual:t};n.on("change",(n=>{switch(n){case"manual":a.value=(0,o.default)(t.value);break;case"lastfm":a.value=(0,o.default)(e.value);break;default:throw new Error("Invalid value for nowPlayingSource.")}}));for(const[e,t]of Object.entries(r))t.on("change",(t=>{n.value===e&&(a.value=(0,o.default)(t))}))}()},708:(e,t,n)=>{var a,r=(a=n(376))&&a.__esModule?a:{default:a};function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}const l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=r?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(a,l,i):a[l]=e[l]}return a.default=e,n&&n.set(e,a),a}(n(798)).get(),i=l.Replicant("casters"),s=l.Replicant("radiaSettings"),u=l.bundleConfig.radia;l.listenFor("getLiveCommentators",(async(e,t)=>{(async function(e,t,n){return new Promise(((a,o)=>{r.default.get(`${e}/live/guild/${n}`,{headers:{Authorization:t}}).then((e=>{const{data:t}=e;if(t.error)return void o(t.error);const n=[];t.forEach((e=>{n.push({discordId:e.discord_user_id,name:e.name,twitter:`@${e.twitter}`,pronouns:e.pronouns})})),a(n)})).catch((e=>{o(e)}))}))})(u.url,u.authentication,s.value.guildID).then((e=>{if(e.length<=0)return t("Got no commentators from API.");const n=e.slice(0,3),a=e.slice(3);i.value=n.reduce(((e,t)=>{const n=t.discordId;return delete t.discordId,e[n]=t,e}),{}),t(null,{add:n,extra:a})})).catch((e=>{404===e.response.status&&t(null,null),t(e)}))}))},19:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleRoundData=p;var a,r=(a=n(376))&&a.__esModule?a:{default:a},o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=r?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)),l=n(279),i=n(367);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}const u=o.get(),c=u.Replicant("rounds");u.listenFor("getRounds",(async(e,t)=>{e.url?async function(e){return new Promise(((t,n)=>{r.default.get(e,{responseType:"json"}).then((n=>{const a=p(n.data);t({rounds:a,url:e})})).catch((e=>{n(e)}))}))}(e.url).then((e=>{c.value={...c.value,...e.rounds},t(null,e.url)})).catch((e=>{t(e)})):t(new Error("Missing arguments."),null)}));const f=l.splatStages.map((e=>e.toLowerCase())),d=l.splatModes.map((e=>e.toLowerCase()));function p(e){const t={};for(let a=0;a<e.length;a++){const r=e[a],o=[],s=null==r.games?r.maps:r.games;if(s){for(let e=0;e<s.length;e++){const t=s[e],a=null==t.stage?t.map:t.stage;o.push({stage:(n=a,n=n.toLowerCase(),f.includes(n)?l.splatStages[f.indexOf(n)]:"Unknown Stage"),mode:g(t.mode)})}t[(0,i.generateId)()]={meta:{name:r.name},games:o}}}var n;return t}function g(e){return e=e.toLowerCase(),d.includes(e)?l.splatModes[d.indexOf(e)]:"Unknown Mode"}},575:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleRawData=d;var a,r=(a=n(376))&&a.__esModule?a:{default:a},o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=r?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)),l=n(367);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}const s=o.get(),u=s.Replicant("tournamentData");let c;async function f(e,t,n,a=!1){return new Promise(((o,i)=>{r.default.post("https://api.smash.gg/gql/alpha",JSON.stringify({query:"query Entrants($slug: String!, $page: Int!, $perPage: Int!) {\n\t\ttournament(slug: $slug) {\n\t\tid\n\t\tname\n\t\tteams(query: {\n\t\t\tpage: $page\n\t\t\tperPage: $perPage\n\t\t}) {\n\t\t\tpageInfo {\n\t\t\ttotal\n\t\t\ttotalPages\n\t\t\t}\n\t\t\tnodes {\n\t\t\tid\n\t\t\tname\n\t\t\tentrant {\n\t\t\t\tid\n\t\t\t\tparticipants {\n\t\t\t\tid\n\t\t\t\tgamerTag\n\t\t\t\t}\n\t\t\t}\n\t\t\t}\n\t\t}\n\t\t}\n\t}",variables:{slug:t,page:e,perPage:"50"}}),{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n}`}}).then((e=>{const{data:t}=e,n=[];for(let e=0;e<t.data.tournament.teams.nodes.length;e++){const a=[],r=t.data.tournament.teams.nodes[e];if(!r.entrant)continue;for(let e=0;e<r.entrant.participants.length;e++){const t=r.entrant.participants[e].gamerTag;a.push({name:t})}const o=r.name;n.push({id:(0,l.generateId)(),name:o,players:a})}o(a?{pageInfo:n,raw:t}:{pageInfo:n})})).catch((e=>{i(e)}))}))}function d(e,t){for(let t=0;t<e.length;t++)e[t].id=(0,l.generateId)();return{meta:{id:t},data:e}}s.bundleConfig&&void 0!==s.bundleConfig.smashgg?c=s.bundleConfig.smashgg.apiKey:s.log.warn(`"smashgg" is not defined in cfg/${s.bundleName}.json! Importing tournament data from smash.gg will not be possible.`),s.listenFor("getTournamentData",(async(e,t)=>{if(e.id&&e.method)switch(e.method){case"battlefy":(async function(e){const t="https://dtmwra1jsgyb0.cloudfront.net/tournaments/"+e+"/teams";return new Promise(((n,a)=>{r.default.get(t).then((t=>{const{data:r}=t;if(r.error)return void a(r.error);const o={meta:{id:e},data:[]};for(let e=0;e<r.length;e++){const t=r[e],n={id:(0,l.generateId)(),name:t.name,logoUrl:t.persistentTeam.logoUrl,players:[]};for(let e=0;e<t.players.length;e++){const a=t.players[e],r={name:a.inGameName,username:a.username};n.players.push(r)}o.data.push(n)}n(o)})).catch((e=>{a(e)}))}))})(e.id).then((e=>{u.value=e,t(null,e.meta.id)})).catch((e=>{t(e)}));break;case"smashgg":if(!c){t(new Error("No smash.gg token provided."));break}(async function(e,t){return new Promise(((n,a)=>{f(1,e,t,!0).then((async a=>{const r={meta:{id:e},data:[]};if(r.data=r.data.concat(a.pageInfo),a.raw.data.tournament.teams.pageInfo.totalPages>1){const n=[];for(let r=2;r<=a.raw.data.tournament.teams.pageInfo.totalPages;r++)n.push(f(r,e,t));const o=await Promise.all(n);for(let e=0;e<o.length;e++)r.data=r.data.concat(o[e].pageInfo)}n(r)})).catch((e=>{a(e)}))}))})(e.id,c).then((e=>{u.value=e,t(null,e.meta.id)})).catch((e=>{t(e)}));break;case"raw":(async function(e){return new Promise(((t,n)=>{r.default.get(e).then((n=>{const a=d(n.data,e);t(a)})).catch((e=>{n(e)}))}))})(e.id).then((e=>{u.value=e,t(null,e.id)})).catch((e=>{t(e)}));break;default:t(new Error("Invalid method given."))}else t(new Error("Missing arguments."),null)}))},798:(e,t)=>{let n;Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){n=e},t.get=function(){return n}},367:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateId=function(){return String(Math.random().toString(36).substr(2,9))}},279:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.splatModes=t.splatStages=void 0;const n=["Ancho-V Games","Arowana Mall","Blackbelly Skatepark","Camp Triggerfish","Goby Arena","Humpback Pump Track","Inkblot Art Academy","Kelp Dome","MakoMart","Manta Maria","Moray Towers","Musselforge Fitness","New Albacore Hotel","Piranha Pit","Port Mackerel","Shellendorf Institute","Shifty Station","Snapper Canal","Starfish Mainstage","Sturgeon Shipyard","The Reef","Wahoo World","Walleye Warehouse","Skipper Pavilion","Unknown Stage"];t.splatStages=n,n.sort();const a=["Clam Blitz","Tower Control","Rainmaker","Splat Zones","Turf War","Unknown Mode"];t.splatModes=a,a.sort()},376:e=>{e.exports=require("axios")},198:e=>{e.exports=require("clone")},118:e=>{e.exports=require("express-fileupload")},172:e=>{e.exports=require("lastfm")}},t={},n=function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}(715);module.exports=n})();
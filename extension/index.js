(()=>{"use strict";var e={59:(e,t,n)=>{var a,r=n(19),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=r?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)),l=(a=n(118))&&a.__esModule?a:{default:a},s=n(575);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}const i=o.get(),c=i.Router();c.post("/upload-tournament-json",(0,l.default)({limits:{fileSize:52428800}}),((e,t)=>{if(!e.files||!e.files.file||!e.body.jsonType||"application/json"!==e.files.file.mimetype)return t.sendStatus(400);const n=e.files.file,a=JSON.parse(n.data.toString());switch(e.body.jsonType){case"rounds":{const e=(0,r.handleRoundData)(a),t=i.Replicant("rounds");t.value={...t.value,...e};break}case"teams":{const e=(0,s.handleRawData)(a,n.name);(0,s.updateTeamDataReplicants)(e);break}default:return t.sendStatus(400)}t.sendStatus(200)})),i.mount("/ipl-overlay-controls",c)},57:(e,t,n)=>{function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}const r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var s=o?Object.getOwnPropertyDescriptor(e,l):null;s&&(s.get||s.set)?Object.defineProperty(r,l,s):r[l]=e[l]}return r.default=e,n&&n.set(e,r),r}(n(798)).get(),o=r.Replicant("gameWinners"),l=r.Replicant("teamScores"),s=r.Replicant("setWinnersAutomatically"),u=r.Replicant("activeRoundId");l.on("change",((e,t)=>{if(!s.value||!t)return;const n=e.teamA+e.teamB;1===n&&(1===e.teamA?o.value[0]=1:o.value[0]=2),n>=2&&0!==o.value[0]&&(e.teamA===t.teamA?o.value[n-1]=2:o.value[n-1]=1)})),u.on("change",((e,t)=>{t&&(o.value=[0,0,0,0,0,0,0])}))},715:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var s=o?Object.getOwnPropertyDescriptor(e,l):null;s&&(s.get||s.set)?Object.defineProperty(a,l,s):a[l]=e[l]}return a.default=e,n&&n.set(e,a),a}(n(798));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}t.default=e=>{a.set(e),n(550),n(57),n(575),n(19),n(59);const t=e.Replicant("radiaSettings");e.bundleConfig&&void 0!==e.bundleConfig.radia?(t.value.enabled=!0,n(708)):(e.log.warn(`"radia" is not defined in cfg/${e.bundleName}.json! The ability to import data via the Radia\n            Production API won't be possible.`),t.value.enabled=!1)},e.exports=t.default},550:(e,t,n)=>{var a,r=n(172),o=(a=n(198))&&a.__esModule?a:{default:a};function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(a,o,s):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)).get();!function(){if(!s.bundleConfig||void 0===s.bundleConfig.lastfm)return void s.log.warn(`"lastfm" is not defined in cfg/${s.bundleName}.json! Getting music information automatically will not function.`);const e=new r.LastFmNode({api_key:s.bundleConfig.lastfm.apiKey,secret:s.bundleConfig.lastfm.secret}),t=s.Replicant("lastFmNowPlaying",{persistent:!1});let n;s.Replicant("lastFmSettings").on("change",(a=>{n&&n.stop(),n=e.stream(a.username),n.on("nowPlaying",(e=>{t.value={artist:e.artist["#text"],song:e.name,album:e.album["#text"],cover:e.image[2]["#text"],artistSong:`${e.artist["#text"]} - ${e.name}`}})),n.on("error",(e=>{6===e.error&&(s.log.info(`Last.fm couldn't find user "${a.username}" - error message: "${e.message}"`),n.stop())})),n.start()}))}(),function(){const e=s.Replicant("lastFmNowPlaying"),t=s.Replicant("manualNowPlaying"),n=s.Replicant("nowPlayingSource"),a=s.Replicant("nowPlaying"),r={lastfm:e,manual:t};n.on("change",(n=>{switch(n){case"manual":a.value=(0,o.default)(t.value);break;case"lastfm":a.value=(0,o.default)(e.value);break;default:throw new Error("Invalid value for nowPlayingSource.")}}));for(const[e,t]of Object.entries(r))t.on("change",(t=>{n.value===e&&(a.value=(0,o.default)(t))}))}()},708:(e,t,n)=>{var a,r=(a=n(376))&&a.__esModule?a:{default:a};function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}const l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var s=r?Object.getOwnPropertyDescriptor(e,l):null;s&&(s.get||s.set)?Object.defineProperty(a,l,s):a[l]=e[l]}return a.default=e,n&&n.set(e,a),a}(n(798)).get(),s=l.Replicant("casters"),u=l.Replicant("radiaSettings"),i=l.bundleConfig.radia;l.listenFor("getLiveCommentators",(async(e,t)=>{(async function(e,t,n){return new Promise(((a,o)=>{r.default.get(`${e}/live/guild/${n}`,{headers:{Authorization:t}}).then((e=>{200===e.status?a(e.data):o(`Radia API call failed with response ${e.status.toString()}`)})).catch((e=>{o(e)}))}))})(i.url,i.authentication,u.value.guildID).then((e=>{if(e.length<=0)return t("Got no commentators from API.");const n=e.slice(0,3),a=e.slice(3);s.value=n.reduce(((e,t)=>{const n=t.discord_user_id;return delete t.discord_user_id,e[n]=t,e}),{}),t(null,{add:n,extra:a})})).catch((e=>{404===e.response.status&&t(null,null),t(e)}))}))},19:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleRoundData=p;var a,r=(a=n(376))&&a.__esModule?a:{default:a},o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=r?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)),l=n(279),s=n(367);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}const i=o.get(),c=i.Replicant("rounds");i.listenFor("getRounds",(async(e,t)=>{e.url?async function(e){return new Promise(((t,n)=>{r.default.get(e,{responseType:"json"}).then((n=>{const a=p(n.data);t({rounds:a,url:e})})).catch((e=>{n(e)}))}))}(e.url).then((e=>{c.value={...c.value,...e.rounds},t(null,e.url)})).catch((e=>{t(e)})):t(new Error("Missing arguments."),null)}));const f=l.splatStages.map((e=>e.toLowerCase())),d=l.splatModes.map((e=>e.toLowerCase()));function p(e){const t={};for(let a=0;a<e.length;a++){const r=e[a],o=[],u=null==r.games?r.maps:r.games;if(u){for(let e=0;e<u.length;e++){const t=u[e],a=null==t.stage?t.map:t.stage;o.push({stage:(n=a,n=n.toLowerCase(),f.includes(n)?l.splatStages[f.indexOf(n)]:"Unknown Stage"),mode:g(t.mode)})}t[(0,s.generateId)()]={meta:{name:r.name},games:o}}}var n;return t}function g(e){return e=e.toLowerCase(),d.includes(e)?l.splatModes[d.indexOf(e)]:"Unknown Mode"}},575:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateTeamDataReplicants=g,t.handleRawData=y;var a=u(n(376)),r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=r?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}return a.default=e,n&&n.set(e,a),a}(n(798)),o=n(367),l=u(n(198));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}function u(e){return e&&e.__esModule?e:{default:e}}const i=r.get(),c=i.Replicant("tournamentData"),f=i.Replicant("scoreboardData"),d=i.Replicant("nextTeams");let p;function g(e){if(e.data.length<=0)throw new Error("Tournament has no teams.");c.value=e;const t=e.data[0],n=e.data[1]||e.data[0];f.value.teamAInfo=(0,l.default)(t),f.value.teamBInfo=(0,l.default)(n),d.value.teamAInfo=(0,l.default)(e.data[2]||t),d.value.teamBInfo=(0,l.default)(e.data[3]||n)}async function m(e,t,n,r=!1){return new Promise(((l,s)=>{a.default.post("https://api.smash.gg/gql/alpha",JSON.stringify({query:"query Entrants($slug: String!, $page: Int!, $perPage: Int!) {\n\t\ttournament(slug: $slug) {\n\t\tid\n\t\tname\n\t\tteams(query: {\n\t\t\tpage: $page\n\t\t\tperPage: $perPage\n\t\t}) {\n\t\t\tpageInfo {\n\t\t\ttotal\n\t\t\ttotalPages\n\t\t\t}\n\t\t\tnodes {\n\t\t\tid\n\t\t\tname\n\t\t\tentrant {\n\t\t\t\tid\n\t\t\t\tparticipants {\n\t\t\t\tid\n\t\t\t\tgamerTag\n\t\t\t\t}\n\t\t\t}\n\t\t\t}\n\t\t}\n\t\t}\n\t}",variables:{slug:t,page:e,perPage:"50"}}),{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n}`}}).then((e=>{const{data:t}=e,n=[];for(let e=0;e<t.data.tournament.teams.nodes.length;e++){const a=[],r=t.data.tournament.teams.nodes[e];if(!r.entrant)continue;for(let e=0;e<r.entrant.participants.length;e++){const t=r.entrant.participants[e].gamerTag;a.push({name:t})}const l=r.name;n.push({id:(0,o.generateId)(),name:l,players:a})}l(r?{pageInfo:n,raw:t}:{pageInfo:n})})).catch((e=>{s(e)}))}))}function y(e,t){for(let t=0;t<e.length;t++)e[t].id=(0,o.generateId)();return{meta:{id:t,source:"Uploaded file"},data:e}}i.bundleConfig&&void 0!==i.bundleConfig.smashgg?p=i.bundleConfig.smashgg.apiKey:i.log.warn(`"smashgg" is not defined in cfg/${i.bundleName}.json! Importing tournament data from smash.gg will not be possible.`),i.listenFor("getTournamentData",(async(e,t)=>{if(e.id&&e.method)switch(e.method){case"battlefy":(async function(e){const t=await async function(e){const t=`https://api.battlefy.com/tournaments/${e}`;return(await a.default.get(t)).data.name}(e),n="https://dtmwra1jsgyb0.cloudfront.net/tournaments/"+e+"/teams";return new Promise(((r,l)=>{a.default.get(n).then((n=>{const{data:a}=n;if(a.error)return void l(a.error);const s={meta:{id:e,source:"Battlefy",name:t},data:[]};for(let e=0;e<a.length;e++){const t=a[e],n={id:(0,o.generateId)(),name:t.name,logoUrl:t.persistentTeam.logoUrl,players:[]};for(let e=0;e<t.players.length;e++){const a=t.players[e],r={name:a.inGameName,username:a.username};n.players.push(r)}s.data.push(n)}r(s)})).catch((e=>{l(e)}))}))})(e.id).then((e=>{g(e),t(null,e.meta.id)})).catch((e=>{t(e)}));break;case"smashgg":if(!p){t(new Error("No smash.gg token provided."));break}(async function(e,t){return new Promise(((n,a)=>{m(1,e,t,!0).then((async a=>{const r={meta:{id:e,source:"Smash.gg",name:a.raw.data.tournament.name},data:[]};if(r.data=r.data.concat(a.pageInfo),a.raw.data.tournament.teams.pageInfo.totalPages>1){const n=[];for(let r=2;r<=a.raw.data.tournament.teams.pageInfo.totalPages;r++)n.push(m(r,e,t));const o=await Promise.all(n);for(let e=0;e<o.length;e++)r.data=r.data.concat(o[e].pageInfo)}n(r)})).catch((e=>{a(e)}))}))})(e.id,p).then((e=>{g(e),t(null,e.meta.id)})).catch((e=>{t(e)}));break;case"raw":(async function(e){return new Promise(((t,n)=>{a.default.get(e).then((n=>{const a=y(n.data,e);t(a)})).catch((e=>{n(e)}))}))})(e.id).then((e=>{g(e),t(null,e.id)})).catch((e=>{t(e)}));break;default:t(new Error("Invalid method given."))}else t(new Error("Missing arguments."),null)}))},798:(e,t)=>{let n;Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){n=e},t.get=function(){return n}},367:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateId=function(){return String(Math.random().toString(36).substr(2,9))}},279:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.splatModes=t.splatStages=void 0;const n=["Ancho-V Games","Arowana Mall","Blackbelly Skatepark","Camp Triggerfish","Goby Arena","Humpback Pump Track","Inkblot Art Academy","Kelp Dome","MakoMart","Manta Maria","Moray Towers","Musselforge Fitness","New Albacore Hotel","Piranha Pit","Port Mackerel","Shellendorf Institute","Shifty Station","Snapper Canal","Starfish Mainstage","Sturgeon Shipyard","The Reef","Wahoo World","Walleye Warehouse","Skipper Pavilion","Unknown Stage"];t.splatStages=n,n.sort();const a=["Clam Blitz","Tower Control","Rainmaker","Splat Zones","Turf War","Unknown Mode"];t.splatModes=a,a.sort()},376:e=>{e.exports=require("axios")},198:e=>{e.exports=require("clone")},118:e=>{e.exports=require("express-fileupload")},172:e=>{e.exports=require("lastfm")}},t={},n=function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}(715);module.exports=n})();
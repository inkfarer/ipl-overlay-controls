(()=>{var t={957:(t,e,n)=>{const a=n(118),{handleRoundData:o}=n(81),{handleRawData:r}=n(44);t.exports=function(t){const e=t.Router();e.post("/upload-tournament-json",a({limits:{fileSize:52428800}}),((e,n)=>{if(!e.files||!e.files.file||!e.body.jsonType||"application/json"!==e.files.file.mimetype)return n.sendStatus(400);const a=JSON.parse(e.files.file.data.toString());switch(e.body.jsonType){case"rounds":const s=o(a),i=t.Replicant("rounds");i.value={...i.value,...s};break;case"teams":const l=r(a,`Uploaded file: ${e.files.file.name}`);t.Replicant("tournamentData").value=l;break;default:return n.sendStatus(400)}n.sendStatus(200)})),t.mount("/ipl-overlay-controls",e)}},902:t=>{t.exports=function(t){const e=t.Replicant("gameWinners"),n=t.Replicant("teamScores"),a=t.Replicant("setWinnersAutomatically");n.on("change",((t,n)=>{if(!a.value||!n)return;const o=t.teamA+t.teamB;1===o&&(1===t.teamA?e.value[0]=1:e.value[0]=2),o>=2&&0!==e.value[0]&&(t.teamA!==n.teamA?e.value[o-1]=1:e.value[o-1]=2)})),t.Replicant("activeRoundId").on("change",((t,n)=>{n&&(e.value=[0,0,0,0,0,0,0])}))}},387:(t,e,n)=>{"use strict";t.exports=function(t){n(405)(t),n(902)(t),n(44).listen(t),n(81).listen(t),n(957)(t),n(185).listen(t)}},405:(t,e,n)=>{const a=n(172).LastFmNode,o=n(198);t.exports=function(t){!function(t){if(!t.bundleConfig||void 0===t.bundleConfig.lastfm)return void t.log.error(`"lastfm" is not defined in cfg/${t.bundleName}.json! Some graphics may not function as expected.`);const e=new a({api_key:t.bundleConfig.lastfm.apiKey,secret:t.bundleConfig.lastfm.secret}),n=t.Replicant("lastFmNowPlaying",{persistent:!1});var o;t.Replicant("lastFmSettings").on("change",(a=>{o&&o.stop(),(o=e.stream(a.username)).on("nowPlaying",(t=>{n.value={artist:t.artist["#text"],song:t.name,album:t.album["#text"],cover:t.image[2]["#text"],artistSong:`${t.artist["#text"]} - ${t.name}`}})),o.on("error",(e=>{6===e.error&&(t.log.info(`Last.fm couldn't find user "${a.username}" - error message: "${e.message}"`),o.stop())})),o.start()}))}(t),function(t){const e=t.Replicant("lastFmNowPlaying"),n=t.Replicant("manualNowPlaying"),a={lastfm:e,manual:n},r=t.Replicant("nowPlayingSource"),s=t.Replicant("nowPlaying");r.on("change",(t=>{switch(t){case"manual":s.value=o(n.value);break;case"lastfm":s.value=o(e.value)}}));for(const[t,e]of Object.entries(a))e.on("change",(e=>{r.value===t&&(s.value=o(e))}))}(t)}},185:(t,e,n)=>{const a=n(376).default;t.exports={listen:async function(t){const e=t.Replicant("casters"),n=t.Replicant("radiaSettings");let o,r;if(!t.bundleConfig||void 0===t.bundleConfig.radia)return t.log.error(`"radia" is not defined in cfg/${t.bundleName}.json! The ability to import data via the Radia\n\t\t\tProduction API is not possible`),void(n.value.enabled=!1);o=t.bundleConfig.radia.url,r=t.bundleConfig.radia.authentication,n.value.enabled=!0,t.listenFor("getLiveCommentators",(async(t,s)=>{(async function(t,e,n){return new Promise(((o,r)=>{a.get(`${t}/live/guild/${n}`,{headers:{Authorization:e}}).then((t=>{const e=t.data;if(e.error)return void r(e.error);let n=[];e.forEach((function(t,e){n.push({discord_user_id:t.discord_user_id,name:t.name,twitter:`@${t.twitter}`,pronouns:t.pronouns})})),o(n)})).catch((t=>{r(t)}))}))})(o,r,n.value.guildID).then((t=>{if(t.length<=0)return s("Got no commentators from API.");const n=t.slice(0,3),a=t.slice(3);e.value=n.reduce(((t,e)=>{const n=e.discord_user_id;return delete e.discord_user_id,t[n]=e,t}),{}),s(null,{add:n,extra:a})})).catch((t=>{404===t.response.status&&s(null,null),s(t)}))}))}}},81:(t,e,n)=>{const a=n(376).default,o=["Ancho-V Games","Arowana Mall","Blackbelly Skatepark","Camp Triggerfish","Goby Arena","Humpback Pump Track","Inkblot Art Academy","Kelp Dome","MakoMart","Manta Maria","Moray Towers","Musselforge Fitness","New Albacore Hotel","Piranha Pit","Port Mackerel","Shellendorf Institute","Shifty Station","Snapper Canal","Starfish Mainstage","Sturgeon Shipyard","The Reef","Wahoo World","Walleye Warehouse","Skipper Pavilion","Unknown Stage"],r=o.map((t=>t.toLowerCase())),s=["Clam Blitz","Tower Control","Rainmaker","Splat Zones","Turf War","Unknown Mode"],i=s.map((t=>t.toLowerCase()));function l(t){let e={};for(let a=0;a<t.length;a++){const s=t[a],i=[],l=null==s.games?s.maps:s.games;if(l){for(let t=0;t<l.length;t++){const e=l[t],a=null==e.stage?e.map:e.stage;i.push({stage:(n=a,n=n.toLowerCase(),r.includes(n)?o[r.indexOf(n)]:"Unknown Stage"),mode:u(e.mode)})}e[""+Math.random().toString(36).substr(2,9)]={meta:{name:s.name},games:i}}}var n;return e}function u(t){return t=t.toLowerCase(),i.includes(t)?s[i.indexOf(t)]:"Unknown Mode"}t.exports={listen:async function(t){const e=t.Replicant("rounds");t.listenFor("getRounds",(async(t,n)=>{t.url?async function(t){return new Promise(((e,n)=>{a.get(t,{Accept:"application/json"}).then((n=>{const a=l(n.data);e({rounds:a,url:t})})).catch((t=>{n(t)}))}))}(t.url).then((t=>{e.value={...e.value,...t.rounds},n(null,t.url)})).catch((t=>{n(t)})):n(new Error("Missing arguments."),null)}))},handleRoundData:l}},44:(t,e,n)=>{const a=n(376);function o(){return""+Math.random().toString(36).substr(2,9)}async function r(t,e,n,r=!1){return new Promise(((s,i)=>{a.post("https://api.smash.gg/gql/alpha",JSON.stringify({query:"query Entrants($slug: String!, $page: Int!, $perPage: Int!) {\n\t\ttournament(slug: $slug) {\n\t\tid\n\t\tname\n\t\tteams(query: {\n\t\t\tpage: $page\n\t\t\tperPage: $perPage\n\t\t}) {\n\t\t\tpageInfo {\n\t\t\ttotal\n\t\t\ttotalPages\n\t\t\t}\n\t\t\tnodes {\n\t\t\tid\n\t\t\tname\n\t\t\tentrant {\n\t\t\t\tid\n\t\t\t\tparticipants {\n\t\t\t\tid\n\t\t\t\tgamerTag\n\t\t\t\t}\n\t\t\t}\n\t\t\t}\n\t\t}\n\t\t}\n\t}",variables:{slug:e,page:t,perPage:"50"}}),{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n}`}}).then((t=>{const e=t.data;let n=[];for(let t=0;t<e.data.tournament.teams.nodes.length;t++){let a=[];const r=e.data.tournament.teams.nodes[t];if(!r.entrant)continue;for(let t=0;t<r.entrant.participants.length;t++){let e=r.entrant.participants[t].gamerTag;a.push({name:e})}let s=r.name;n.push({id:o(),name:s,players:a})}s(r?{pageInfo:n,raw:e}:{pageInfo:n})})).catch((t=>{i(t)}))}))}function s(t,e){for(let e=0;e<t.length;e++)t[e].id=o();return{meta:{id:e},data:t}}t.exports={listen:async function(t){const e=t.Replicant("tournamentData");var n;t.bundleConfig&&void 0!==t.bundleConfig.smashgg?n=t.bundleConfig.smashgg.apiKey:t.log.error(`"smashgg" is not defined in cfg/${t.bundleName}.json! Importing tournament data from smash.gg will not be possible.`),t.listenFor("getTournamentData",(async(t,i)=>{if(t.id&&t.method)switch(t.method){case"battlefy":return void async function(t){const e="https://dtmwra1jsgyb0.cloudfront.net/tournaments/"+t+"/teams";return new Promise(((n,r)=>{a.get(e).then((e=>{const a=e.data;if(a.error)return void r(a.error);let s={meta:{id:t},data:[]};for(let t=0;t<a.length;t++){const e=a[t];var i={id:o(),name:e.name,logoUrl:e.persistentTeam.logoUrl,players:[]};for(let t=0;t<e.players.length;t++){const n=e.players[t];let a={name:n.inGameName,username:n.username};i.players.push(a)}s.data.push(i)}n(s)})).catch((t=>{r(t)}))}))}(t.id).then((t=>{e.value=t,i(null,t.meta.id)})).catch((t=>{i(t)}));case"smashgg":return n?void async function(t,e){return new Promise((async(n,a)=>{r("1",t,e,!0).then((async a=>{var o={meta:{id:t},data:[]};if(o.data=o.data.concat(a.pageInfo),a.raw.data.tournament.teams.pageInfo.totalPages>1)for(let n=2;n<=a.raw.data.tournament.teams.pageInfo.totalPages;n++){let a=await r(n,t,e);o.data=o.data.concat(a.pageInfo)}n(o)})).catch((t=>{a(t)}))}))}(t.id,n).then((t=>{e.value=t,i(null,t.meta.id)})).catch((t=>{i(t)})):void i(new Error("No smash.gg token provided."));case"raw":return void async function(t){return new Promise(((e,n)=>{a.get(t).then((n=>{const a=s(n.data,t);e(a)})).catch((t=>{n(t)}))}))}(t.id).then((t=>{e.value=t,i(null,t.id)})).catch((t=>{i(t)}))}else i(new Error("Missing arguments."),null)}))},handleRawData:s}},376:t=>{"use strict";t.exports=require("axios")},198:t=>{"use strict";t.exports=require("clone")},118:t=>{"use strict";t.exports=require("express-fileupload")},172:t=>{"use strict";t.exports=require("lastfm")}},e={},n=function n(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,n),r.exports}(387);module.exports=n})();